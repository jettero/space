# Repository Guidelines

## Project Structure & Module Organization
- Package code: `space/` (see `setup.cfg` and `pyproject.toml`).
- Tests: `t/` (configured via `pytest.ini:testpaths = t`).
- Build artifacts: `build/`, `dist/`, `space.egg-info/`.
- Config/tooling: `Makefile`, `pytest.ini`, `.pre-commit-config.yaml`, `pylintrc`.
- Requirements: `requirements.txt` (runtime), `test-requirements.txt` (dev/test). Markers: `reqs`, `mods`.

## Build, Test, and Development Commands
- `make` or `make test` — run test suite (`pytest t`).
- `pre-commit run --all-files` — run linters/formatters (pylint, black, hooks).
- `python -m build` — build sdist/wheel (also via `make build`) when cutting releases.
- `pip install -Ur test-requirements.txt` — install test-only deps if needed (`make reqs`).

## Coding Style & Naming Conventions
- Lint: `pylint` (configured by `pylintrc`). Format: `black` (via pre-commit).
- Indentation: 4 spaces; UTF-8; Unix newlines.
- Naming: modules `snake_case.py`; classes `CamelCase`; functions/vars `snake_case`; constants `UPPER_SNAKE`.
- Keep modules focused; prefer small, testable functions. Type hints encouraged for public APIs.

### Map/Generator Conventions
- Floors: use `Floor` for room interiors, `Corridor` for hallways; both subclass `Cell` and render the same by default.
- Walkability checks: use `isinstance(x, Cell)` instead of checking subclasses.
- Partition smoothing: `Map.cellify_partitions()` opens partitions as `Corridor` tiles; keep docstrings brief.
- Color: default colorized output treats floors/corridors with the same grey (`boring_color`). Avoid per-type hues unless explicitly requested.

## Testing Guidelines
- Framework: `pytest` (see `pytest.ini` for `-v --ff --show-capture=stderr --maxfail=1`).
- Tests live in `t/`; name files `test_*.py`. Use `-k name` for focused runs.
- Keep tests deterministic; avoid network; isolate I/O (tmp paths/fixtures).
- Run `make test` before commits. Prefer small, verifiable changes; avoid unrelated fixes in the same patch.

## Commit & Pull Request Guidelines
- Commits: imperative subject line (<=72 chars); explain rationale when non-trivial.
- Keep diffs focused; reference issues (e.g., `Fixes #123`).
- PRs: include summary, motivation, test coverage, and any UX/build notes or screenshots.
- CI must pass: tests (`make test`) and hooks (`pre-commit`).

## Notes on Versioning & Build
- Version is generated by `setuptools_scm` into `space/version.py` (see `pyproject.toml`).
- Do not edit `space/version.py` manually; tag releases via Git to bump version metadata.
- For local development, do not install the package; run tests directly via `make test`.

## Agent Tips
- Be concise. Add minimal docstrings that explain purpose and key args; avoid long narratives.
- When adding flags like `cellify_partitions=True`, document with a very short phrase (e.g., "open short partitions").
- Prefer surgical changes; don’t refactor broadly unless asked.
- Respect `pytest.ini` settings; use `rg` for repo scans; read files in ≤250-line chunks.
